---
layout: post
title:  "Paxos 算法"
subtitle: ""
date:   2020-11-23 10:13:45 +0800
tags:
  - translate
categories: [translate]
comment: true
---



最近在帕克索斯岛上的考古发现表明，尽管议会的兼职议员们有四处走动的倾向，但议会还是能够照常运作。尽管议员们经常从议会中闯出，而且忘记带他们的信使，但是议员们仍然能保存一致的议会记录副本。帕克索斯议会协议提供了一种实现分布式系统设计的状态机的新方法。

> 这篇投稿是最近在 TOCS 编辑部的文件柜后面发现的。尽管年事已高，但主编认为这本书值得出版。由于作者目前正在希腊群岛进行实地工作，无法联系到他，因此请我准备出版。
>
> 作者似乎是个考古学家，对计算机科学只有短暂的兴趣。这是不幸的;尽管大多数计算机科学家对他所描述的神秘的远古 Paxon 文明并不感兴趣，但它的立法系统对于如何在异步环境中实现分布式计算机系统来说是一个极好的模型。实际上，Paxons 对其协议的一些改进在系统文献中似乎是未知的。
>
> 在第 4 节中，作者简要讨论了 Paxon 议会与分布式计算的相关性。计算机科学家可能会想先读这部分。甚至在那之前，他们可能想读一下 Lampson[1996]给计算机科学家的算法解释。De Prisco 等人[1997]也更正式地描述了该算法。在第 4 节的最后，我对古代协议和最近的工作之间的关系做了进一步的评论。
>
> ​																														Keith Marzullo
> ​																														University of California, San Diego  

# 1 问题

## 1.1 帕克索斯岛

在本世纪初，爱琴海的帕克索斯岛是一个繁荣的商业中心。财富造就了政治世故，帕克森人用议会形式的政府取代了古老的神权政治。但是贸易比公民责任重要，在帕克索斯没有人愿意把他的一生奉献给议会。尽管议员们在会议室中不断地进进出出，帕克森议会还是需要正常运行。

用一个兼职议会来进行管理的问题与当今容错分布式系统所面临的问题有着明显的对应关系，议员与进程对应，离开议院则对应着失败。帕克森的解决方案也许会让计算机科学家感兴趣。在这里，我简要介绍了 Paxos 议会协议的历史，然后对其与分布式系统的相关性进行了更简短的讨论。

帕克森文明被外来入侵所摧毁，考古学家最近才开始挖掘它的历史。因此，我们对帕克森议会的了解是不完整的。虽然基本协议已经直到了，但对其中许多细节还不清楚。如果对这些细节感兴趣，我将大胆猜测帕克森人可能会做些什么。

## 1.2 需求

议会的主要任务是决定岛上的法律，这些法律是由它通过的一系列法令来定义的。现代的议会会雇佣秘书来记录会议活动，但是在帕克索斯，没有人愿意呆在会议室里在整个会议期间充当秘书。相反，每个帕克森议员都有一本总账，记录通过法令的编号顺序。例如，立法者*Λ˘ινχ∂*的总账有如下条目：

```plain
155: 橄榄税是每吨3德拉克马
```

如果她相信议会通过的第 155 号法令规定橄榄税为每吨 3 德拉克马。总账是用不褪色的墨水写的，账项不能被更改。

议会协议的第一个需求是要保证*总账的一致性*。这意味着两本总账不能包含相互矛盾的信息。如果议员*Φισ∂ρ   *的总账上有如下条目：

```plain
132: 灯必须只用橄榄油
```

那么其他议员的总账上不会出现不同的 132 法规。然而，如果另一名议员还不知道法令已经通过，他可能就没有第 132 号法令的记录。

由于可能会出现全部留白的情况，总账的一致性还不够充分。需要一些额外的手段来确保法令最终通过并被记录再总账上。在现代议会中，议员之间的分歧阻碍了法令的通过。但帕克索斯的情况并非如此，那里弥漫着相互信任的气氛。帕克索斯的议员们愿意通过任何提出的法令。然而，他们四处游荡的倾向带来了一个问题。假设有一组议员通过了这条法令：

```plain
37: 禁止在寺庙墙上作画
```

然后跑去参加宴会了，接着另一组议员来到了会议室，然后在不知情的情况下，通过了一条冲突的法令：

```plain
37: 艺术表达自由得到保障
```

除非有足够多的议员在议会中呆足够长的时间，否则就无法保证立法有进展。因为帕克森议员们不愿减少他们在外界的活动，所以是不可能确保可以通过任何法令的。*然而，议员们愿意保证，在议院期间，他们和他们的助手将对议会的所有事务迅速采取行动*。这个保证使得帕克森人可以设计出满足如下*progress condition*的议会协议：

- 如果议会中多数议员在会议室中，且没有人在足够长的时间内进出会议室，则当前会议室中议员提出的任何法令均可获得通过，通过的每一项法令都将记录在当前会议室中每个议员的账本上。

## 1.3 假设

为了满足议会协议的要求，需要为议员们提供一些资源。每一位议员都收到一份用以记录法令的坚固账本，还有一支笔和擦不掉的墨水。议员们离开会议室之后可能会忘记他们做过什么，所以他们会在账本后面写笔记提醒自己议会的重要任务。*法令清单上的条目不会被改变，但是笔记可以划掉。*为了实现进展条件，要求议员能够衡量时间的流逝，所以给了他们简单的沙漏计时器。

议员们随时带着他们的账本，随时都能看到那些法令和那些没有被划掉的笔记。账本是用最好的羊皮纸制作的，只用于最重要的笔记。立法者会在一张普通的纸上写下其他笔记，当他离开议院时，他可能会(也可能不会)丢掉这些笔记。

会议室的音响条件很差，无法展开辩论，议员们只能通过报信人沟通，但是他们有钱可以想雇佣多少信使就雇佣多少信使。信使不会混淆信息，但他可能会忘记他已经传递了某个信息，然后再传一遍。像他们所服务的议员一样，信使们只把他们的部分时间用于履行议会职责。在传递消息之前信使可能会离开会议室去处理一些事情——也许是一段六个月的航程。他甚至可能永远离开，在这种情况下，信息永远不会被传递。

虽然议员和信使可以在任何时候出入会议室，但是在会议室里，他们献身于议会事务。当他们还在会议室时，信使及时地传递信息，议员对他们收到的任何信息迅速作出反应。

帕克索斯的官方记录声称，议员和信使是一丝不苟的诚实，并严格遵守议会的协议。大多数学者认为这是一种宣传，试图将帕克索斯描绘成道德上优于其东部邻国。不诚实虽然少见，但毫无疑问确实发生过。然而，因为它从未在官方文件中提及，我们不知道议会是如何对付不诚实的议员或信使的。已发现的证据在第 3.3.5 节中讨论。

# 2 单法令大会

帕克森议会由早期的仪式的牧师会议演变而来，该会议每 19 年召开一次，选择一个单一的，具有象征意义的法令。几个世纪以来，宗教会议通过传统程序选择法令，要求所有牧师到场。但是随着商业的繁荣，会议进行时，牧师们开始在会议厅里进进出出。最后，旧的协议失败了，会议没有选择任何法令。为了防止这种神学灾难的重演，帕克森的宗教领袖要求数学家们制定一个协议来选择教会的法令。协议书的要求和假设基本上和后来的议会相同，除了不包含一系列的法令，一本账本最多只能有一个法令。由此产生的会议协议将在这里描述；议会协议书见第 3 节。

数学家们通过一系列步骤推导出了议会协议。首先，他们证明了满足一定约束条件的协议可以保证一致性并允许进展。一个初步的协议然后直接从这些约束导出。初步协议的一个受限版本提供了保证一致性但不保证进展的基本协议。通过对基本协议的限制，得到了满足一致性和进度要求的完整的会议协议。

数学结果描述在 2.1 节，在 2.2-2.4 节中非正式地描述了这些协议。附录中有对基本协议更正式的描述和正确性证明。

## 2.1 数学推导

教会的法令是通过一系列被编号的投票选出的，投票是对单一法令的全民公投。在每次投票中，牧师只能选择投票还是不投票。与投票相联系的是一组被称为法定人数（quorum）的牧师。当且仅当在法定人数内的每位牧师都对法令进行投票后，投票才能算成功。形式上，选票 B 由以下四个部分组成。(除非另有限制，集表示有限集。)
$$
\begin{align}
&B_{dec}\quad &一个法令（被投票的法令）\\
&B_{qrm}\quad &一个非空的牧师集（投票的法定人数）\\
&B_{vot}\quad &一个牧师集（那些投票支持法令的人）\\
&B_{bal}\quad &投票数
\end{align}
$$
当且仅当$$